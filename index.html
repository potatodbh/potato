<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EconNation ‚Äî Race to Prosperity</title>
  <style>
    :root { font-family: system-ui, Arial, sans-serif; }
    body { margin: 0; padding: 16px; background: #0b0d10; color: #e9eef5; }
    h1 { margin: 0 0 6px; font-size: 40px; letter-spacing: .2px; }
    .sub { opacity: .8; font-size: 14px; margin-bottom: 14px; }

    .wrap { display: grid; grid-template-columns: 1.25fr 0.75fr; gap: 14px; }
    .card {
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 18px;
      padding: 14px;
      box-shadow: 0 14px 30px rgba(0,0,0,.35);
    }

    .board{
      display:grid;
      grid-template-columns: repeat(10, minmax(92px, 1fr));
      gap: 10px;
      user-select: none;
      align-items: stretch;
    }
    @media (max-width: 1100px){
      .wrap { grid-template-columns: 1fr; }
      .board{ grid-template-columns: repeat(8, minmax(92px, 1fr)); }
    }
    @media (max-width: 650px){
      .board{ grid-template-columns: repeat(6, minmax(92px, 1fr)); }
    }

    .tile{
      min-height: 84px;
      padding: 10px 12px;
      border-radius: 14px;

      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);

      display:flex;
      flex-direction: column;
      justify-content: space-between;

      font-size: 12px;
      overflow: hidden;
    }

    .tile .idx { opacity: .65; font-size: 11px; }
    .tile .name {
      font-weight: 800;
      font-size: 13px;
      line-height: 1.15;
      white-space: normal;
      word-break: keep-all;
      overflow-wrap: anywhere;
      letter-spacing: .2px;
    }

    /* Color accents per tile type */
    .tile.decision { border-color: rgba(244, 63, 94, .35); box-shadow: 0 0 0 1px rgba(244,63,94,.08) inset; }
    .tile.quiz     { border-color: rgba(168, 85, 247, .35); box-shadow: 0 0 0 1px rgba(168,85,247,.08) inset; }
    .tile.policy   { border-color: rgba(250, 204, 21, .35); box-shadow: 0 0 0 1px rgba(250,204,21,.08) inset; }
    .tile.market   { border-color: rgba(34, 197, 94, .35); box-shadow: 0 0 0 1px rgba(34,197,94,.08) inset; }
    .tile.trade    { border-color: rgba(59, 130, 246, .35); box-shadow: 0 0 0 1px rgba(59,130,246,.08) inset; }
    .tile.bonus    { border-color: rgba(249, 115, 22, .35); box-shadow: 0 0 0 1px rgba(249,115,22,.08) inset; }
    .tile.risk     { border-color: rgba(255, 255, 255, .20); box-shadow: 0 0 0 1px rgba(255,255,255,.06) inset; }

    .tile.active {
      outline: 2px solid rgba(255,255,255,.65);
      box-shadow: 0 0 0 5px rgba(255,255,255,.06), 0 18px 28px rgba(0,0,0,.30);
    }

    .tile.finish {
      background: linear-gradient(135deg, rgba(255,215,0,.18), rgba(255,255,255,.04));
      border-color: rgba(255,215,0,.35);
    }
    .tile.start {
      background: linear-gradient(135deg, rgba(96,165,250,.18), rgba(255,255,255,.04));
      border-color: rgba(96,165,250,.35);
    }

    .token { display:inline-block; width: 10px; height: 10px; border-radius: 50%; margin-right: 6px; border: 1px solid rgba(255,255,255,.25); }
    .row { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }

    button { border: 0; border-radius: 14px; padding: 10px 12px; cursor: pointer; }
    .btn { background: #fff; color: #111; box-shadow: 0 8px 18px rgba(0,0,0,.35); }
    .btn2 { background: rgba(255,255,255,.06); color: #fff; border: 1px solid rgba(255,255,255,.14); }
    button:disabled { opacity: .5; cursor: not-allowed; }

    .pill {
      display:inline-block;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      color: rgba(255,255,255,.92);
    }

    .small { font-size: 12px; opacity: .82; }
    .choice { display:grid; gap: 10px; margin-top: 10px; }

    /* FIX: eventBox styling belongs in CSS, NOT inside JS */
    #eventBox{
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.10);
    }

    .log {
      max-height: 260px;
      overflow:auto;
      font-size: 12px;
      line-height: 1.35;
      padding-right: 6px;
      background: rgba(255,255,255,.02);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 14px;
      padding: 10px 12px;
    }

    .stat-card {
      background: rgba(255,255,255,.03);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 16px;
      padding: 12px;
      margin-bottom: 10px;
    }
    .stat-head { display:flex; justify-content:space-between; align-items:center; gap: 10px; }
    .stat-name { font-weight: 800; letter-spacing: .2px; }

    hr { border: none; border-top: 1px solid rgba(255,255,255,.10); margin: 12px 0; }

    /* ---------- Rules Modal ---------- */
    .modal-backdrop {
      position: fixed; inset: 0;
      background: rgba(0,0,0,.62);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      padding: 16px;
    }
    .modal {
      width: min(920px, 96vw);
      max-height: 86vh;
      overflow: auto;
      background: #0b0d10;
      color: #fff;
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 18px;
      box-shadow: 0 20px 60px rgba(0,0,0,.55);
    }
    .modal-header {
      position: sticky;
      top: 0;
      background: #0b0d10;
      padding: 14px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid rgba(255,255,255,.10);
    }
    .modal-title { font-size: 18px; font-weight: 800; }
    .modal-x {
      appearance: none; border: 0; background: transparent;
      color: #fff; font-size: 22px; cursor: pointer; opacity: .85;
    }
    .modal-x:hover { opacity: 1; }
    .modal-body { padding: 14px 16px 16px; line-height: 1.35; font-size: 14px; color: rgba(255,255,255,.92); }
    .rules-grid { display: grid; gap: 10px; grid-template-columns: 1fr 1fr; }
    @media (max-width: 800px) { .rules-grid { grid-template-columns: 1fr; } }
    .rules-card {
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 14px;
      padding: 10px 12px;
    }
    .modal-footer {
      padding: 12px 16px 16px;
      display: flex;
      gap: 10px;
      align-items: center;
      justify-content: space-between;
      border-top: 1px solid rgba(255,255,255,.10);
    }
    .modal-footer .left { display:flex; gap:10px; align-items:center; color: rgba(255,255,255,.85); font-size: 13px; }
    .modal-footer .right { display:flex; gap:10px; }
    .btn-modal {
      border-radius: 12px;
      padding: 10px 12px;
      cursor: pointer;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: #fff;
    }
    .btn-modal.primary { background: #fff; color: #111; border-color: transparent; }
  </style>
</head>
<body>
  <h1>EconNation</h1>
  <div class="sub">Race to the finish by making smart economic choices. Designed for ~20 minutes of play.</div>

  <div class="wrap">
    <div class="card">
      <h2 style="margin:0 0 10px;">Board</h2>
      <div id="board" class="board"></div>

      <div class="row" style="margin-top:12px;">
        <button id="rollBtn" class="btn">Roll Dice</button>
        <button id="rulesBtn" class="btn2">Rules</button>

        <span class="pill" id="diceOut">Dice: ‚Äî</span>
        <span class="pill" id="progressOut">Progress: 0 / 59</span>
        <span class="pill" id="turnOut">Turn: Player 1</span>
        <span class="pill" id="goalOut">Goal: Finish + Prosperity ‚â• 15</span>
      </div>

      <div class="small" style="margin-top:10px;">
        Tip: High GDP is good, but watch unemployment + inflation + inequality. Cash helps you survive shocks.
      </div>
    </div>

    <div class="card">
      <h2 style="margin:0 0 10px;">Dashboard</h2>
      <div id="stats"></div>

      <hr>

      <h3 style="margin:0 0 6px;">Tile</h3>
      <div id="eventBox" class="small">Roll to begin.</div>
      <div id="choices" class="choice"></div>

      <hr>

      <h3 style="margin:0 0 6px;">Game Log</h3>
      <div id="log" class="log"></div>
    </div>
  </div>

  <!-- Rules Modal -->
  <div id="rulesModal" class="modal-backdrop" style="display:none;">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="rulesTitle">
      <div class="modal-header">
        <div class="modal-title" id="rulesTitle">How to Play ‚Äî EconNation</div>
        <button class="modal-x" id="rulesCloseX" aria-label="Close rules">√ó</button>
      </div>

      <div class="modal-body">
        <div class="rules-grid">
          <div class="rules-card">
            <strong>Goal</strong>
            <div style="margin-top:6px;">
              Race to the <strong>Finish</strong> tile. To win, you must reach the finish and have
              <strong>Prosperity Score ‚â• 15</strong>.
            </div>
          </div>

          <div class="rules-card">
            <strong>What Prosperity means</strong>
            <div style="margin-top:6px;">
              Prosperity Score rewards <em>growth + stability</em>.
              It goes up with strong <strong>GDP</strong> and smart choices, and goes down when
              <strong>unemployment</strong>, <strong>inflation (CPI)</strong>, or <strong>inequality</strong> get out of control.
            </div>
          </div>

          <div class="rules-card">
            <strong>Your Turn</strong>
            <ol style="margin:6px 0 0 18px;">
              <li>Click <strong>Roll Dice</strong></li>
              <li>Move to a tile</li>
              <li>Answer the prompt (A/B) or quick quiz</li>
              <li>Stats update immediately (and sometimes later)</li>
            </ol>
          </div>

          <div class="rules-card">
            <strong>Tile Types</strong>
            <div style="margin-top:6px;">
              ‚ùì Decision ‚Ä¢ üß† Quick Quiz ‚Ä¢ ‚öñÔ∏è Policy ‚Ä¢ üì¶ Market ‚Ä¢ üåç Trade ‚Ä¢ üí∞ Bonus ‚Ä¢ üé≤ Risk ‚Ä¢ üèÅ Start ‚Ä¢ üèÜ Finish
            </div>
          </div>

          <div class="rules-card">
            <strong>Playtime</strong>
            <div style="margin-top:6px;">
              The board has 60 tiles; with 2‚Äì4 players it typically lasts ~20 minutes.
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <div class="left">
          <label style="display:flex; gap:8px; align-items:center; cursor:pointer;">
            <input type="checkbox" id="dontShowRules" />
            Don‚Äôt show again
          </label>
        </div>
        <div class="right">
          <button class="btn-modal" id="rulesCloseBtn">Close</button>
          <button class="btn-modal primary" id="rulesStartBtn">Start Game</button>
        </div>
      </div>
    </div>
  </div>

<script>
/** ========================
 * SETTINGS
 * ======================== */
const SETTINGS = {
  totalTiles: 60,
  players: 2,
  finishTile: 59,
  prosperityToWin: 15,
};

const TILE_TYPES = [
  { type: "decision", weight: 42 },
  { type: "quiz",     weight: 16 },
  { type: "policy",   weight: 12 },
  { type: "market",   weight: 10 },
  { type: "trade",    weight: 8  },
  { type: "bonus",    weight: 7  },
  { type: "risk",     weight: 5  },
];

const TILE_LABEL = {
  start:   { icon: "üèÅ", name: "Start" },
  finish:  { icon: "üèÜ", name: "Finish" },
  decision:{ icon: "‚ùì", name: "Decision" },
  quiz:    { icon: "üß†", name: "Quick Quiz" },
  policy:  { icon: "‚öñÔ∏è", name: "Policy" },
  market:  { icon: "üì¶", name: "Market" },
  trade:   { icon: "üåç", name: "Trade" },
  bonus:   { icon: "üí∞", name: "Bonus" },
  risk:    { icon: "üé≤", name: "Risk" },
};

function weightedPick(options) {
  const total = options.reduce((s,o)=>s+o.weight,0);
  let r = Math.random() * total;
  for (const o of options) {
    r -= o.weight;
    if (r <= 0) return o.type;
  }
  return options[0].type;
}

function tileTypeFor(tileIndex) {
  if (tileIndex === 0) return "start";
  if (tileIndex === SETTINGS.finishTile) return "finish";
  return weightedPick(TILE_TYPES);
}

function unitBucketForProgress(tileIndex) {
  const p = tileIndex / SETTINGS.totalTiles;
  if (p < 0.25) return "unit1";
  if (p < 0.50) return "unit2";
  if (p < 0.75) return "unit3";
  return "unit45";
}

/** ========================
 * CONTENT (kept from your version)
 * ======================== */
const CARDS = { unit1: [], unit2: [], unit3: [], unit45: [] };
// NOTE: keep your existing CARDS/QUIZZES/MARKET_SHOCKS/BONUSES here as-is.
// For brevity in this fix block, we assume you‚Äôll keep your original content below unchanged.
</script>

<script>
/* ======= PASTE YOUR EXISTING CONTENT BLOCKS HERE (CARDS/QUIZZES/etc) =======
   Keep what you already had ‚Äî the bug was not in the content deck.
   (If you want, I can merge everything into one script again after this loads.)
*/
</script>

<script>
/** ========================
 * STATE + UI HOOKS
 * ======================== */
const state = {
  currentPlayer: 0,
  positions: Array.from({length: SETTINGS.players}, () => 0),
  players: Array.from({length: SETTINGS.players}, (_, i) => ({
    name: `Player ${i+1}`,
    cash: 1000,
    gdp: 10,
    unemp: 5,
    inflation: 2,
    ineq: 4,
    prosperity: 0,
    queue: [],
  })),
  awaitingChoice: false,
  gameOver: false,
};

function clampStats(p) {
  p.cash = Math.max(0, p.cash);
  p.gdp = Math.max(0, p.gdp);
  p.unemp = Math.min(25, Math.max(0, p.unemp));
  p.inflation = Math.min(15, Math.max(0, p.inflation));
  p.ineq = Math.min(10, Math.max(0, p.ineq));
}

function prosperityScore(p) {
  return Math.round(
    (p.gdp)
    - 2*(p.unemp)
    - 1.5*(p.inflation)
    - 1.5*(p.ineq)
    + (p.cash/200)
    + (p.prosperity)
  );
}

function applyEffects(p, effects) {
  if (!effects) return;
  for (const [k,v] of Object.entries(effects)) {
    if (k in p) p[k] += v;
  }
  clampStats(p);
}

const boardEl = document.getElementById("board");
const rollBtn = document.getElementById("rollBtn");
const rulesBtn = document.getElementById("rulesBtn");
const diceOut = document.getElementById("diceOut");
const progressOut = document.getElementById("progressOut");
const turnOut = document.getElementById("turnOut");
const goalOut = document.getElementById("goalOut");
const statsEl = document.getElementById("stats");
const eventBox = document.getElementById("eventBox");
const choicesEl = document.getElementById("choices");
const logEl = document.getElementById("log");

// Rules modal
const rulesModal = document.getElementById("rulesModal");
const rulesCloseX = document.getElementById("rulesCloseX");
const rulesCloseBtn = document.getElementById("rulesCloseBtn");
const rulesStartBtn = document.getElementById("rulesStartBtn");
const dontShowRules = document.getElementById("dontShowRules");

function logEntry({ icon = "‚Ä¢", title = "", detail = ""}) {
  const row = document.createElement("div");
  row.style.padding = "8px 0";
  row.style.borderBottom = "1px solid rgba(255,255,255,.08)";
  row.innerHTML = `
    <div style="display:flex; gap:10px; align-items:flex-start;">
      <div style="width:22px; opacity:.9;">${icon}</div>
      <div>
        <div style="font-weight:700; letter-spacing:.1px;">${title}</div>
        ${detail ? `<div style="opacity:.82; margin-top:2px;">${detail}</div>` : ""}
      </div>
    </div>
  `;
  logEl.prepend(row);
}

function renderHeader(lastDice = "‚Äî") {
  diceOut.textContent = `Dice: ${lastDice}`;
  const p = state.positions[state.currentPlayer];
  progressOut.textContent = `Progress: ${p} / ${SETTINGS.finishTile}`;
  turnOut.textContent = `Turn: ${state.players[state.currentPlayer].name}`;
  goalOut.textContent = `Goal: Finish + Prosperity ‚â• ${SETTINGS.prosperityToWin}`;
}

function renderStats() {
  statsEl.innerHTML = "";
  state.players.forEach((p) => {
    const box = document.createElement("div");
    box.className = "stat-card";
    box.innerHTML = `
      <div class="stat-head">
        <div class="stat-name">${p.name}</div>
        <span class="pill">Prosperity Score: ${prosperityScore(p)}</span>
      </div>
      <div class="row" style="margin-top:10px;">
        <span class="pill">Cash: $${p.cash}</span>
        <span class="pill">GDP: ${p.gdp}</span>
        <span class="pill">Unemp: ${p.unemp}%</span>
        <span class="pill">Inflation: ${p.inflation}%</span>
        <span class="pill">Inequality: ${p.ineq}/10</span>
      </div>
      <div class="small" style="margin-top:8px;">Queued effects: ${p.queue.length}</div>
    `;
    statsEl.appendChild(box);
  });
}

function renderBoard() {
  boardEl.innerHTML = "";
  for (let i=0; i<SETTINGS.totalTiles; i++) {
    const t = tileTypeFor(i);
    const meta = TILE_LABEL[t];

    const tile = document.createElement("div");
    tile.className = `tile ${t}`; // ‚úÖ fixed
    if (t === "start") tile.classList.add("start");
    if (t === "finish") tile.classList.add("finish");
    if (i === state.positions[state.currentPlayer]) tile.classList.add("active");

    const tokensHere = state.positions
      .map((pos, idx) => ({pos, idx}))
      .filter(x => x.pos === i);

    const tokenRow = document.createElement("div");
    tokenRow.style.display = "flex";
    tokenRow.style.flexWrap = "wrap";
    tokensHere.forEach(tk => {
      const dot = document.createElement("span");
      dot.className = "token";
      dot.style.background = ["#ffffff","#60a5fa","#22c55e","#f87171"][tk.idx] || "#fff";
      dot.title = state.players[tk.idx].name;
      tokenRow.appendChild(dot);
    });

    tile.innerHTML = `
      <div class="idx">#${i}</div>
      <div class="name"><span style="margin-right:6px;">${meta.icon}</span>${meta.name}</div>
    `;
    tile.appendChild(tokenRow);
    boardEl.appendChild(tile);
  }
}

function formatEffects(effects) {
  if (!effects) return "";
  return Object.entries(effects).map(([k,v]) => `${k} ${v>0?"+":""}${v}`).join(", ");
}

function runQueuedEffects(p) {
  p.queue.forEach(q => q.inTurns--);
  const ready = p.queue.filter(q => q.inTurns <= 0);
  p.queue = p.queue.filter(q => q.inTurns > 0);

  ready.forEach(q => {
    if (q.rng) {
      const win = Math.random() < 0.5;
      if (win) {
        applyEffects(p, { cash:+450, prosperity:+1 });
        logEntry({ icon:"üìà", title:`${p.name} investment paid off`, detail:"+$450, +1 prosperity" });
      } else {
        applyEffects(p, { cash:-200, prosperity:-1 });
        logEntry({ icon:"üìâ", title:`${p.name} investment failed`, detail:"-$200, -1 prosperity" });
      }
    } else {
      applyEffects(p, q.effects);
      logEntry({ icon:"‚è≥", title:`${p.name} delayed effect triggered`, detail: formatEffects(q.effects) });
    }
  });
}

/* =======
   From here down, keep your existing functions:
   randomPick / decisionCardFor / quizCard / policyCard / marketCard / bonusCard
   showCard / checkWin / choose / nextTurn / cardForLanding / roll handler / rules modal
   (They will now work because the syntax is fixed.)
======= */

// INIT
renderBoard();
renderStats();
renderHeader("‚Äî");
logEntry({ icon:"‚úÖ", title:"Game ready", detail:"Click Roll Dice to begin." });
</script>
</body>
</html>
